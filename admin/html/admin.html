<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Admin Dashboard - Blessence</title>
    <link rel="icon" href="../images/mainlogo1.png" type="image/png" />

    <!-- External Stylesheets -->
    <link rel="stylesheet" href="../styles/styles.css" />
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.6.0/css/all.min.css"
      crossorigin="anonymous"
      referrerpolicy="no-referrer"
    />

    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <!-- Add this with your other scripts -->
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels@2.0.0"></script>
    <!-- SortableJS (ADDED FOR DRAG AND DROP) -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Sortable/1.15.0/Sortable.min.js"></script>

    <script src="../../admin/styles/logout.js"></script>

    <!-- SweetAlert2 CSS & JS -->
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/sweetalert2@11/dist/sweetalert2.min.css"
    />
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11/dist/sweetalert2.all.min.js"></script>

    <script src="../js/admin-session.js"></script>

    <style>
      /* --- EXISTING STYLES RETAINED --- */
      .fullscreen-reveal {
        position: fixed;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%) scale(0);
        width: 100px;
        height: 100px;
        border-radius: 50%;
        background: linear-gradient(
          135deg,
          #ffffff 0%,
          #fff5f9 30%,
          #ffe6f2 70%,
          #ffd1dc 100%
        );
        z-index: 9999;
        display: none;
        justify-content: center;
        align-items: center;
        overflow: hidden;
        box-shadow: 0 0 0 0 rgba(255, 229, 236, 0.7);
        transition: transform 0.8s cubic-bezier(0.4, 0, 0.2, 1);
        transform-origin: center center;
      }

      .reveal-overlay {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: transparent;
        z-index: 9998;
        display: none;
        opacity: 0;
        transition: opacity 0.5s ease;
      }

      .fullscreen-reveal.active {
        display: flex;
      }

      .fullscreen-reveal.expanding {
        transform: translate(-50%, -50%) scale(20);
        transition: transform 0.8s cubic-bezier(0.4, 0, 0.2, 1);
      }

      .fullscreen-reveal-content {
        position: absolute;
        top: 40%;
        left: 50%;
        transform: translate(-50%, -50%);
        font-size: 20px;
        color: white;
        opacity: 0;
        text-align: center;
        pointer-events: none;
        transition: opacity 0.5s ease;
      }

      .fullscreen-reveal.expanding .fullscreen-reveal-content {
        opacity: 1;
        transform: scale(1);
      }

      .reveal-progress {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        border-radius: 50%;
        background: conic-gradient(rgb(172, 163, 163) 0%, transparent 0%);
        mask: radial-gradient(transparent 65%, black 66%);
        -webkit-mask: radial-gradient(transparent 65%, black 66%);
        z-index: 1;
      }

      .cashier-mode-entry {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: linear-gradient(135deg, #e497aa 0%, #db8299 100%);
        z-index: 10000;
        display: none;
        justify-content: center;
        align-items: center;
        flex-direction: column;
        opacity: 0;
        transition: opacity 0.5s ease;
      }

      .cashier-mode-entry.active {
        display: flex;
        opacity: 1;
      }

      .cashier-logo-container {
        text-align: center;
        margin-bottom: 30px;
        animation: pulse 2s infinite;
      }

      .cashier-logo {
        width: 120px;
        height: 120px;
        border-radius: 50%;
        background: white;
        display: flex;
        justify-content: center;
        align-items: center;
        margin: 0 auto 20px;
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
      }

      .cashier-logo img {
        max-width: 80px;
        max-height: 80px;
      }

      .cashier-title {
        font-size: 2.5rem;
        font-weight: 700;
        color: white;
        margin-bottom: 10px;
        text-shadow: 0 2px 10px rgba(0, 0, 0, 0.2);
      }

      .cashier-subtitle {
        font-size: 1.2rem;
        color: rgba(255, 255, 255, 0.9);
        margin-bottom: 30px;
      }

      .cashier-loading {
        display: flex;
        gap: 10px;
        margin-top: 20px;
      }

      .cashier-loading-dot {
        width: 12px;
        height: 12px;
        border-radius: 50%;
        background: white;
        opacity: 0.6;
        animation: loadingDots 1.4s infinite ease-in-out;
      }

      .cashier-loading-dot:nth-child(1) {
        animation-delay: -0.32s;
      }

      .cashier-loading-dot:nth-child(2) {
        animation-delay: -0.16s;
      }

      @keyframes pulse {
        0% {
          transform: scale(1);
        }

        50% {
          transform: scale(1.05);
        }

        100% {
          transform: scale(1);
        }
      }

      @keyframes loadingDots {
        0%,
        80%,
        100% {
          transform: scale(0.8);
          opacity: 0.5;
        }

        40% {
          transform: scale(1);
          opacity: 1;
        }
      }

      .stats-buttons {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
        gap: 20px;
        margin-bottom: 35px;
      }

      .stat-btn {
        border: none;
        border-radius: 16px;
        padding: 28px 24px;
        color: white;
        font-weight: 600;
        font-size: 1rem;
        cursor: pointer;
        transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        display: flex;
        flex-direction: column;
        align-items: flex-start;
        text-align: left;
        box-shadow: 0 8px 16px rgba(0, 0, 0, 0.1);
        position: relative;
        overflow: hidden;
        background: var(--primary-pink);
      }

      /* --- NEW: Stats specific drag style --- */
      .stat-wrapper {
        cursor: grab;
      }
      .stat-wrapper:active {
        cursor: grabbing;
      }
      /* ------------------------------------- */

      .stat-btn::before {
        content: "";
        position: absolute;
        top: 0;
        right: -50%;
        width: 100%;
        height: 100%;
        background: linear-gradient(
          90deg,
          transparent,
          rgba(255, 255, 255, 0.2),
          transparent
        );
        transform: skewX(-20deg);
        transition: right 0.6s ease;
      }

      .stat-btn:hover::before {
        right: 150%;
      }

      .stat-btn:hover {
        transform: translateY(-8px) scale(1.02);
        box-shadow: 0 16px 32px rgba(0, 0, 0, 0.15);
      }

      .stat-btn i {
        font-size: 2.5rem;
        margin-bottom: 15px;
        opacity: 0.95;
        position: relative;
        z-index: 1;
      }

      .stat-value {
        font-size: 2.2rem;
        margin: 10px 0 5px 0;
        display: block;
        position: relative;
        z-index: 1;
        font-weight: 700;
        letter-spacing: -0.5px;
      }

      .stat-label {
        position: relative;
        z-index: 1;
        font-size: 0.9rem;
        opacity: 0.9;
        font-weight: 500;
      }

      .orders-today {
        background: linear-gradient(135deg, #e497aa 0%, #db8299 100%);
      }

      .this-week {
        background: linear-gradient(135deg, #db8299 0%, #c36c82 100%);
      }

      .total-sales {
        background: linear-gradient(135deg, #c36c82 0%, #b05a70 100%);
      }

      .favorites-count {
        background: linear-gradient(135deg, #b05a70 0%, #9d4e5f 100%);
      }

      /* --- NEW: UNIFIED DRAGGABLE WIDGET CLASS (Replaces chart-container/right-panel distinction) --- */
      .draggable-widget {
        background: white;
        border-radius: 20px;
        padding: 30px 30px 1px 30px;
        margin-bottom: 5px;
        box-shadow: 0 8px 24px rgba(0, 0, 0, 0.06);
        border: 1px solid rgba(228, 151, 170, 0.1);
        position: relative;
        display: flex;
        flex-direction: column;
        transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        height: 100%; /* Fill column height */
      }

      /* Specific override for the big chart to maintain height */
      .sales-chart-widget {
        min-height: 530px;
      }

      .draggable-widget canvas {
        flex: 1 1 auto;
        width: 100% !important;
        display: block;
      }

      .draggable-widget:hover {
        box-shadow: 0 12px 32px rgba(0, 0, 0, 0.1);
        /* Scale effect on hover removed on widget to prevent layout jitter, kept shadow */
        transform: translateY(-4px);
      }

      /* Header inside widget */
      .widget-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 25px;
        flex-wrap: wrap;
        gap: 15px;
        cursor: grab; /* Drag handle area */
      }

      .widget-header:active {
        cursor: grabbing;
      }

      .widget-header h5,
      .widget-header h6 {
        color: var(--dark-pink);
        font-weight: 700;
        margin: 0;
        font-size: 1.1rem;
        display: flex;
        align-items: center;
        gap: 8px;
        pointer-events: none; /* Let clicks pass to header for dragging */
      }

      /* --- SORTABLE JS CLASSES --- */
      .sortable-ghost {
        opacity: 0.4;
        background-color: #fff0f5;
        border: 2px dashed #e497aa;
      }

      .sortable-drag {
        opacity: 0.9;
        transform: scale(1.02);
        box-shadow: 0 20px 40px rgba(0, 0, 0, 0.2);
        z-index: 1000;
      }

      /* --------------------------- */

      .panel-section {
        margin-bottom: 0; /* Remove margin since they are now individual cards */
        height: 100%;
        display: flex;
        flex-direction: column;
      }

      .panel-section h6 i {
        font-size: 1.1rem;
      }

      .placeholder-box {
        border: 2px dashed #ffffff;
        border-radius: 12px;
        padding: 32px 24px;
        text-align: center;
        color: #ffffff;
        background: white;
        font-style: italic;
        transition: all 0.4s ease;
        position: relative;
        overflow: hidden;
      }

      .placeholder-box::before {
        content: "";
        position: absolute;
        top: 50%;
        left: 50%;
        width: 0;
        height: 0;
        border-radius: 50%;
        background: rgba(228, 151, 170, 0.1);
        transform: translate(-50%, -50%);
        transition: all 0.5s ease;
      }

      .placeholder-box:hover::before {
        width: 200%;
        height: 200%;
      }

      .placeholder-box:hover {
        border-color: var(--primary-pink);
        background: white;
        transform: translateY(-4px);
        box-shadow: 0 8px 16px rgba(228, 151, 170, 0.15);
      }

      .btn-group {
        display: flex;
        gap: 6px;
        flex-wrap: wrap;
        margin-right: 20px;
      }

      .btn-group .btn {
        border-radius: 10px !important;
        font-size: 0.85rem;
        padding: 8px 16px;
        border: 2px solid #e0e0e0;
        background: white;
        color: #666;
        font-weight: 500;
        transition: all 0.3s ease;
        position: relative;
        overflow: hidden;
      }

      .btn-group .btn::before {
        content: "";
        position: absolute;
        top: 50%;
        left: 50%;
        width: 0;
        height: 0;
        background: rgba(228, 151, 170, 0.1);
        border-radius: 50%;
        transform: translate(-50%, -50%);
        transition: width 0.3s ease, height 0.3s ease;
      }

      .btn-group .btn:active::before {
        width: 100px;
        height: 100px;
      }

      .btn-group .btn:hover {
        border-color: var(--primary-pink);
        color: var(--dark-pink);
        background: rgba(228, 151, 170, 0.05);
        transform: translateY(-2px);
      }

      .btn-group .btn.active {
        background: linear-gradient(
          135deg,
          var(--primary-pink),
          var(--secondary-pink)
        );
        border-color: var(--primary-pink);
        color: white;
        box-shadow: 0 4px 12px rgba(228, 151, 170, 0.3);
      }

      .page-header {
        margin-bottom: 30px;
        padding-bottom: 20px;
        border-bottom: 2px solid rgba(228, 151, 170, 0.15);
      }

      .page-title {
        color: var(--dark-pink);
        font-weight: 700;
        font-size: 2rem;
        margin-bottom: 8px;
        letter-spacing: -0.5px;
      }

      .page-header p {
        color: #6c757d;
        font-size: 1rem;
        margin: 0;
      }

      main {
        padding: 35px !important;
        margin-left: 16.666667%;
        width: calc(100% - 16.666667%);
        transition: margin-left 0.3s ease;
      }

      /* Scrollbar logic for lists within widgets */
      .scrollable-list {
        overflow-y: auto;
        max-height: 400px;
        padding-right: 5px;
      }

      .scrollable-list::-webkit-scrollbar {
        width: 6px;
      }

      .scrollable-list::-webkit-scrollbar-track {
        background: #f1f1f1;
        border-radius: 10px;
      }

      .scrollable-list::-webkit-scrollbar-thumb {
        background: var(--primary-pink);
        border-radius: 10px;
      }

      .scrollable-list::-webkit-scrollbar-thumb:hover {
        background: var(--secondary-pink);
      }

      /* Top Customers Table Styles */
      .customers-table-wrapper {
        overflow-x: hidden;
        border-radius: 12px;
      }

      .customers-table {
        width: 100%;
        border-collapse: separate;
        border-spacing: 0;
      }

      .customers-table thead {
        background: linear-gradient(135deg, #e497aa 0%, #db8299 100%);
        position: sticky;
        top: 0;
        z-index: 10;
      }

      .customers-table thead th {
        padding: 16px 20px;
        text-align: left;
        font-weight: 600;
        font-size: 0.9rem;
        color: white;
        text-transform: uppercase;
        letter-spacing: 0.5px;
        border: none;
      }

      .customers-table thead th:first-child {
        border-top-left-radius: 12px;
        padding-left: 24px;
      }

      .customers-table thead th:last-child {
        border-top-right-radius: 12px;
        text-align: right;
        padding-right: 24px;
      }

      .customers-table tbody tr {
        background: white;
        transition: all 0.3s ease;
        border-bottom: 1px solid rgba(228, 151, 170, 0.1);
      }

      .customers-table tbody tr:hover {
        background: #fff5f9;
        transform: scale(1.01);
        box-shadow: 0 4px 12px rgba(228, 151, 170, 0.15);
      }

      .customers-table tbody tr:last-child {
        border-bottom: none;
      }

      .customers-table tbody td {
        padding: 18px 20px;
        vertical-align: middle;
        font-size: 0.95rem;
        color: #333;
      }

      .customers-table tbody td:first-child {
        padding-left: 24px;
      }

      .customers-table tbody td:last-child {
        text-align: right;
        padding-right: 24px;
      }

      .customer-rank {
        display: inline-flex;
        align-items: center;
        justify-content: center;
        width: 32px;
        height: 32px;
        border-radius: 50%;
        background: linear-gradient(135deg, #e497aa 0%, #db8299 100%);
        color: white;
        font-weight: 700;
        font-size: 0.85rem;
        margin-right: 16px;
      }

      .customer-rank.gold {
        background: linear-gradient(135deg, #ffd700 0%, #ffed4e 100%);
        color: #333;
        box-shadow: 0 4px 12px rgba(255, 215, 0, 0.3);
      }

      .customer-rank.silver {
        background: linear-gradient(135deg, #c0c0c0 0%, #e8e8e8 100%);
        color: #333;
        box-shadow: 0 4px 12px rgba(192, 192, 192, 0.3);
      }

      .customer-rank.bronze {
        background: linear-gradient(135deg, #cd7f32 0%, #d4a574 100%);
        color: white;
        box-shadow: 0 4px 12px rgba(205, 127, 50, 0.3);
      }

      .customer-info {
        display: flex;
        align-items: center;
      }

      .customer-table-avatar {
        width: 48px;
        height: 48px;
        border-radius: 50%;
        object-fit: cover;
        border: 3px solid var(--primary-pink);
        margin-right: 16px;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
      }

      .customer-table-initial {
        width: 48px;
        height: 48px;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        background: linear-gradient(135deg, #e497aa 0%, #db8299 100%);
        color: white;
        font-weight: 700;
        font-size: 1.2rem;
        margin-right: 16px;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
      }

      .customer-name {
        font-weight: 600;
        color: var(--dark-pink);
        font-size: 1rem;
      }

      .customer-email {
        font-size: 0.85rem;
        color: #666;
        margin-top: 2px;
      }

      .customer-orders {
        color: #666;
        font-weight: 500;
      }

      .customer-orders .badge {
        background: linear-gradient(135deg, #e497aa 0%, #db8299 100%);
        color: white;
        padding: 6px 12px;
        border-radius: 20px;
        font-weight: 600;
        font-size: 0.85rem;
      }

      .customer-spent {
        font-weight: 700;
        color: var(--dark-pink);
        font-size: 1.1rem;
      }

      .customers-table tbody tr:nth-child(1) .customer-name::after {
        content: " ðŸ‘‘";
      }

      .product-item {
        transition: all 0.3s ease;
        border: 1px solid rgba(228, 151, 170, 0.1);
        background: rgb(242, 226, 230) !important;
        border-radius: 10px;
        margin-bottom: 12px;
        padding: 16px !important;
      }

      .customer-item,
      .insight-item {
        transition: all 0.3s ease;
        border: 1px solid rgba(228, 151, 170, 0.1);
        background: white !important;
        border-radius: 10px;
        margin-bottom: 12px;
        padding: 16px !important;
      }

      .product-item:hover,
      .customer-item:hover,
      .insight-item:hover {
        transform: translateY(-2px);
        box-shadow: 0 4px 12px rgba(228, 151, 170, 0.15);
        border-color: var(--primary-pink);
      }

      .rating-bar-item .progress {
        background-color: #e9ecef;
        border-radius: 4px;
      }

      .rating-bar-item .progress-bar {
        border-radius: 4px;
        transition: width 0.8s ease;
      }

      .customer-avatar {
        transition: all 0.3s ease;
      }

      .customer-item:hover .customer-avatar {
        transform: scale(1.1);
        background: var(--secondary-pink) !important;
      }

      @keyframes fadeInUp {
        from {
          opacity: 0;
          transform: translateY(20px);
        }

        to {
          opacity: 1;
          transform: translateY(0);
        }
      }

      @keyframes fadeIn {
        from {
          opacity: 0;
          transform: translateY(10px);
        }

        to {
          opacity: 1;
          transform: translateY(0);
        }
      }

      .stat-btn,
      .draggable-widget {
        animation: fadeInUp 0.6s ease forwards;
      }

      .stat-btn:nth-child(1) {
        animation-delay: 0.1s;
      }
      .stat-btn:nth-child(2) {
        animation-delay: 0.2s;
      }
      .stat-btn:nth-child(3) {
        animation-delay: 0.3s;
      }
      .stat-btn:nth-child(4) {
        animation-delay: 0.4s;
      }

      .product-item,
      .customer-item,
      .insight-item,
      .rating-bar-item {
        animation: fadeIn 0.5s ease forwards;
      }

      .cashier-tap-counter {
        position: fixed;
        bottom: 20px;
        right: 20px;
        background: rgba(228, 151, 170, 0.9);
        color: white;
        padding: 10px 15px;
        border-radius: 20px;
        font-size: 14px;
        font-weight: 600;
        z-index: 1000;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
        transition: all 0.3s ease;
        display: none;
      }

      .cashier-tap-counter.show {
        display: block;
        animation: fadeIn 0.3s ease;
      }

      .cashier-mode-link {
        color: inherit !important;
      }

      .analytics-card {
        background: white;
        border-radius: 20px;
        padding: 25px;
        box-shadow: 0 8px 24px rgba(0, 0, 0, 0.06);
        border: 1px solid rgba(228, 151, 170, 0.1);
        height: 100%;
        transition: transform 0.3s ease;
      }

      .small-chart-container {
        height: 300px;
        position: relative;
        width: 100%;
        margin-top: 30px;
      }

      /* --- NEW STYLES FOR PROFILE PICS & REVIEWS --- */
      .view-all-link {
        font-size: 0.85rem;
        color: var(--primary-pink);
        text-decoration: none;
        font-weight: 600;
        cursor: pointer;
        transition: color 0.3s;
        margin-right: 20px;
      }

      .view-all-link:hover {
        color: var(--dark-pink);
        text-decoration: underline;
      }

      .customer-img {
        width: 40px;
        height: 40px;
        border-radius: 50%;
        object-fit: cover;
        border: 2px solid var(--primary-pink);
        margin-right: 1rem;
      }

      /* --- MODAL & DROPDOWN STYLES (PRIORITIZED) --- */
      .modal-dialog-scrollable .modal-content {
        overflow: visible !important;
      }

      .modal-header {
        border-bottom: 1px solid rgba(228, 151, 170, 0.2);
        background-color: #fff5f9;
        border-top-left-radius: 20px;
        border-top-right-radius: 20px;
        flex-wrap: wrap;
        padding: 1rem 1.5rem;
        position: relative;
        overflow: visible !important;
        z-index: 1056;
      }

      .modal-title {
        color: var(--dark-pink);
        font-weight: 700;
        margin-right: auto;
      }

      .modal-header .btn-close {
        position: absolute;
        right: 20px;
        top: 50%;
        transform: translateY(-50%);
        z-index: 10;
      }

      .filter-controls {
        display: flex;
        gap: 15px;
        align-items: center;
        flex-wrap: wrap;
      }

      .custom-dropdown-btn {
        background-color: white;
        border: 1px solid rgba(228, 151, 170, 0.5);
        border-radius: 50px;
        padding: 8px 20px;
        font-size: 0.85rem;
        color: var(--dark-pink);
        font-weight: 600;
        min-width: 160px;
        display: flex;
        justify-content: space-between;
        align-items: center;
        transition: all 0.3s ease;
        position: relative;
      }

      .custom-dropdown-btn:hover,
      .custom-dropdown-btn[aria-expanded="true"] {
        background-color: #fff0f5;
        border-color: var(--primary-pink);
        color: var(--dark-pink);
        box-shadow: 0 4px 12px rgba(228, 151, 170, 0.2);
      }

      .custom-dropdown-btn::after {
        margin-left: 10px;
        color: var(--primary-pink);
      }

      .custom-dropdown-menu {
        border: none;
        border-radius: 15px;
        box-shadow: 0 10px 40px rgba(0, 0, 0, 0.15);
        padding: 8px;
        background: white;
        min-width: 180px;
        margin-top: 10px !important;
        animation: fadeIn 0.2s ease;
        z-index: 9999 !important;
        max-height: 300px;
        overflow-y: auto;
      }

      .custom-dropdown-menu::-webkit-scrollbar {
        width: 6px;
      }

      .custom-dropdown-menu::-webkit-scrollbar-thumb {
        background-color: #e497aa;
        border-radius: 10px;
      }

      .custom-dropdown-item {
        border-radius: 10px;
        padding: 10px 15px;
        font-size: 0.9rem;
        color: #666;
        font-weight: 500;
        transition: all 0.2s;
        cursor: pointer;
      }

      .custom-dropdown-item:hover {
        background-color: #fff0f5;
        color: var(--dark-pink);
        transform: translateX(5px);
      }

      .custom-dropdown-item.active {
        background-color: var(--primary-pink);
        color: white;
      }

      /* --- NEW STYLES FOR RECENT ACTIVITY AND CALENDAR --- */
      .activity-item {
        display: flex;
        align-items: flex-start;
        padding: 12px 0;
        border-bottom: 1px solid rgba(228, 151, 170, 0.1);
        transition: all 0.3s ease;
      }

      .activity-item:last-child {
        border-bottom: none;
      }

      .activity-item:hover {
        background-color: #fff5f9;
        border-radius: 10px;
        padding: 12px 10px;
      }

      .activity-icon {
        width: 36px;
        height: 36px;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        margin-right: 12px;
        flex-shrink: 0;
      }

      .activity-content {
        flex: 1;
      }

      .activity-title {
        font-weight: 600;
        color: var(--dark-pink);
        font-size: 0.9rem;
        margin-bottom: 4px;
      }

      .activity-details {
        font-size: 0.8rem;
        color: #666;
        line-height: 1.4;
      }

      .activity-time {
        font-size: 0.75rem;
        color: #999;
        margin-top: 4px;
      }

      /* Calendar Styles */
      .calendar-widget {
        background: white;
        border-radius: 20px;
        padding: 25px;
        box-shadow: 0 8px 24px rgba(0, 0, 0, 0.06);
        border: 1px solid rgba(228, 151, 170, 0.1);
        height: 100%;
      }

      .calendar-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 20px;
      }

      .calendar-month {
        font-weight: 700;
        color: var(--dark-pink);
        font-size: 1.2rem;
      }

      .calendar-nav {
        display: flex;
        gap: 8px;
      }

      .calendar-nav-btn {
        width: 32px;
        height: 32px;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        background: #fff0f5;
        color: var(--dark-pink);
        border: none;
        transition: all 0.3s ease;
      }

      .calendar-nav-btn:hover {
        background: var(--primary-pink);
        color: white;
      }

      .calendar-weekdays {
        display: grid;
        grid-template-columns: repeat(7, 1fr);
        text-align: center;
        margin-bottom: 10px;
        font-weight: 600;
        color: var(--dark-pink);
        font-size: 0.8rem;
      }

      .calendar-days {
        display: grid;
        grid-template-columns: repeat(7, 1fr);
        gap: 5px;
      }

      .calendar-day {
        height: 36px;
        display: flex;
        align-items: center;
        justify-content: center;
        border-radius: 8px;
        font-size: 0.85rem;
        transition: all 0.3s ease;
        cursor: pointer;
      }

      .calendar-day:hover {
        background: #fff0f5;
      }

      .calendar-day.other-month {
        color: #ccc;
      }

      .calendar-day.today {
        background: var(--primary-pink);
        color: white;
        font-weight: 600;
      }

      .calendar-day.expiring {
        position: relative;
      }

      .calendar-day.expiring::after {
        content: "";
        position: absolute;
        bottom: 4px;
        right: 4px;
        width: 6px;
        height: 6px;
        border-radius: 50%;
        background: #ff6b6b;
      }

      /* --- NEW: Calendar Hover Effects --- */
      .calendar-day.expiring {
        position: relative;
        cursor: pointer;
      }

      .calendar-day.expiring::after {
        content: "";
        position: absolute;
        bottom: 4px;
        right: 4px;
        width: 6px;
        height: 6px;
        border-radius: 50%;
        background: #ff6b6b;
        transition: all 0.3s ease;
      }

      .calendar-day.expiring:hover {
        background: #fff0f0 !important;
        border: 1px solid #ff6b6b;
      }

      .calendar-day.expiring:hover::after {
        background: #ff4444;
        transform: scale(1.2);
      }

      .calendar-tooltip {
        position: absolute;
        bottom: 100%;
        left: 50%;
        transform: translateX(-50%);
        background: #333;
        color: white;
        padding: 8px 12px;
        border-radius: 6px;
        font-size: 0.75rem;
        white-space: nowrap;
        z-index: 1000;
        opacity: 0;
        visibility: hidden;
        transition: all 0.3s ease;
        pointer-events: none;
      }

      .calendar-tooltip::after {
        content: "";
        position: absolute;
        top: 100%;
        left: 50%;
        transform: translateX(-50%);
        border: 5px solid transparent;
        border-top-color: #333;
      }

      .calendar-day.expiring:hover .calendar-tooltip {
        opacity: 1;
        visibility: visible;
        bottom: calc(100% + 10px);
      }

      /* Expiration Modal Styles */
      .expiration-product-item {
        display: flex;
        align-items: center;
        padding: 12px;
        border: 1px solid rgba(228, 151, 170, 0.2);
        border-radius: 10px;
        margin-bottom: 10px;
        transition: all 0.3s ease;
        background: #fff5f9;
      }

      .expiration-product-item:hover {
        transform: translateY(-2px);
        box-shadow: 0 4px 12px rgba(228, 151, 170, 0.15);
        border-color: var(--primary-pink);
      }

      .expiration-product-info {
        flex: 1;
      }

      .expiration-product-name {
        font-weight: 600;
        color: var(--dark-pink);
        margin-bottom: 4px;
      }

      .expiration-product-details {
        font-size: 0.85rem;
        color: #666;
      }

      .expiration-product-stock {
        font-size: 0.8rem;
        color: #ff6b6b;
        font-weight: 600;
      }

      .expiration-date-badge {
        background: linear-gradient(135deg, #ff6b6b 0%, #ff4444 100%);
        color: white;
        padding: 6px 12px;
        border-radius: 20px;
        font-size: 0.8rem;
        font-weight: 600;
        margin-left: 10px;
      }

      .expiration-critical {
        border-left: 4px solid #ff4444;
      }

      .expiration-warning {
        border-left: 4px solid #ffa726;
      }

      .expiration-normal {
        border-left: 4px solid #66bb6a;
      }

      /* Calendar day urgency indicators */
      .calendar-day.expiring.critical::after {
        background: #ff4444;
        box-shadow: 0 0 6px rgba(255, 68, 68, 0.5);
      }

      .calendar-day.expiring.warning::after {
        background: #ffa726;
        box-shadow: 0 0 6px rgba(255, 167, 38, 0.5);
      }

      .calendar-day.expiring.normal::after {
        background: #66bb6a;
        box-shadow: 0 0 6px rgba(102, 187, 106, 0.5);
      }

      /* --- RESPONSIVE STYLES (PRIORITIZED) --- */
      @media (max-width: 991px) {
        /* Fix for mobile stats button uniformity */
        @media (max-width: 991px) {
          .stats-buttons {
            grid-template-columns: repeat(2, minmax(0, 1fr)) !important;
            gap: 12px;
          }

          .stat-wrapper {
            min-height: 120px;
            display: flex;
          }

          .stat-btn {
            flex: 1;
            min-height: 120px;
            height: 100% !important;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            align-items: flex-start;
            padding: 16px 12px !important;
            text-align: left;
          }

          .stat-content {
            width: 100%;
            height: 100%;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
          }

          .stat-btn i {
            font-size: 1.6rem !important;
            margin-bottom: 8px !important;
            flex-shrink: 0;
          }

          .stat-value {
            font-size: 1.4rem !important;
            margin: 4px 0 !important;
            line-height: 1.2;
            flex-shrink: 0;
            font-weight: 700;
          }

          .stat-label {
            font-size: 0.8rem !important;
            line-height: 1.2;
            flex-shrink: 0;
            word-wrap: break-word;
            overflow-wrap: break-word;
            max-width: 100%;
            margin: 0 !important;
          }
        }
        .chart-wrapper-fix {
          height: 300px !important; /* Reduced from 450px */
        }

        /* Adjust small charts */
        .small-chart-container {
          height: 250px !important; /* Reduced from 250px */
          margin-top: 20px;
        }

        /* Adjust the sales chart widget minimum height */
        .sales-chart-widget {
          min-height: 380px !important; /* Reduced from 530px */
        }
        .top-customers-container {
          overflow-x: auto !important;
          margin: 0 -10px;
          padding: 0 10px;
        }

        .customers-table-wrapper {
          min-width: 600px; /* Minimum width to prevent squeezing */
          overflow-x: visible;
        }

        .customers-table {
          width: 100%;
          min-width: 600px;
        }

        /* Adjust table cell padding for mobile */
        .customers-table thead th {
          padding: 12px 10px !important;
          font-size: 0.8rem !important;
        }

        .customers-table tbody td {
          padding: 10px 8px !important;
          font-size: 0.85rem !important;
        }

        /* Make customer info more compact */
        .customer-table-avatar,
        .customer-table-initial {
          width: 36px !important;
          height: 36px !important;
          margin-right: 10px !important;
        }

        .customer-name {
          font-size: 0.9rem !important;
        }

        .customer-email {
          font-size: 0.75rem !important;
        }

        .customer-rank {
          width: 28px !important;
          height: 28px !important;
          font-size: 0.75rem !important;
          margin-right: 10px !important;
        }

        main {
          margin-left: 0 !important;
          width: 100% !important;
        }

        .mobile-header {
          display: block;
          z-index: 101;
        }

        .sidebar {
          position: fixed;
          top: 0;
          left: 0;
          height: 100%;
          width: 280px;
          padding-top: 60px;
          transform: translateX(-100%);
          z-index: 100;
          transition: transform 0.3s ease;
        }

        .sidebar.mobile-open {
          transform: translateX(0);
        }

        .sidebar-overlay {
          display: none;
          position: fixed;
          top: 0;
          left: 0;
          width: 100%;
          height: 100%;
          background: rgba(0, 0, 0, 0.5);
          z-index: 99;
        }

        .sidebar-overlay.active {
          display: block;
        }

        .cashier-mode-link {
          position: relative;
          cursor: pointer;
          transition: all 0.3s ease;
          border-radius: 8px;
        }

        .cashier-mode-link.pressing {
          background: rgba(228, 151, 170, 0.15) !important;
          transform: scale(0.95);
        }
      }

      @media (max-width: 768px) {
        .modal-header {
          padding: 15px;
          padding-right: 40px;
        }

        .filter-controls {
          width: 100%;
          flex-direction: column;
          gap: 10px;
          margin-top: 15px;
        }

        .dropdown,
        .custom-dropdown-btn {
          width: 100%;
        }

        .custom-dropdown-menu {
          width: 100%;
        }

        .calendar-widget {
          padding: 15px;
        }

        .calendar-day {
          height: 32px;
          font-size: 0.75rem;
        }
      }

      .animation-fix {
        position: relative;
        min-height: 200px;
      }

      .small-chart-container {
        min-height: 250px;
      }

      /* Visual cue for drag handle on charts/widgets */
      .drag-indicator {
        position: absolute;
        top: 20px;
        right: 20px;
        color: #ddd;
        opacity: 0;
        transition: opacity 0.3s;
        pointer-events: none;
      }

      .draggable-widget:hover .drag-indicator {
        opacity: 1;
      }

      @media (max-width: 768px) {
        .chart-container {
          min-height: 300px;
        }

        .small-chart-container {
          min-height: 200px;
        }
      }
      /* --- FIX FOR GROWING CHART --- */
      .chart-wrapper-fix {
        position: relative;
        height: 450px; /* Give it a strict height */
        width: 100%;
        overflow: hidden;
      }
      /* Export Controls Styles */
      .export-controls .card {
        border: 1px solid rgba(228, 151, 170, 0.2);
        border-radius: 15px;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
      }

      .export-controls .card-body {
        padding: 20px;
      }

      .export-controls .btn {
        border-radius: 10px;
        font-weight: 600;
        padding: 10px 20px;
        transition: all 0.3s ease;
      }

      .export-controls .btn:hover {
        transform: translateY(-2px);
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
      }

      .export-controls .btn-outline-primary {
        border-color: var(--primary-pink);
        color: var(--primary-pink);
      }

      .export-controls .btn-outline-primary:hover {
        background-color: var(--primary-pink);
        border-color: var(--primary-pink);
        color: white;
      }

      .export-controls .btn-outline-danger {
        border-color: #dc3545;
        color: #dc3545;
      }

      .export-controls .btn-outline-danger:hover {
        background-color: #dc3545;
        border-color: #dc3545;
        color: white;
      }
      /* Profile Photo Styles */
      .customer-img {
        width: 40px;
        height: 40px;
        border-radius: 50%;
        object-fit: cover;
        border: 2px solid var(--primary-pink);
        transition: all 0.3s ease;
      }

      .customer-avatar {
        flex-shrink: 0;
        transition: all 0.3s ease;
      }

      .customer-item:hover .customer-img {
        transform: scale(1.05);
        border-color: var(--secondary-pink);
      }

      .customer-item:hover .customer-avatar:not(.customer-avatar-fallback) {
        transform: scale(1.05);
      }

      /* Fallback avatar styles */
      .customer-avatar-fallback {
        font-size: 0.9rem;
        font-weight: bold;
        background: linear-gradient(135deg, #e497aa 0%, #db8299 100%);
        color: white;
      }

      /* --- NEW STYLES FOR INDEPENDENT FILTER --- */
      .global-filter-container {
        background: white;
        border-radius: 20px;
        padding: 25px;
        padding-bottom: 0px;
        box-shadow: 0 8px 24px rgba(0, 0, 0, 0.06);
        border: 1px solid rgba(228, 151, 170, 0.1);
        margin-bottom: 15px;
        transition: all 0.3s ease;
      }

      .global-filter-container:hover {
        box-shadow: 0 12px 32px rgba(0, 0, 0, 0.1);
      }

      .filter-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 20px;
        flex-wrap: wrap;
        gap: 15px;
      }

      .filter-header h5 {
        color: var(--dark-pink);
        font-weight: 700;
        margin: 0;
        font-size: 1.2rem;
        display: flex;
        align-items: center;
        gap: 8px;
      }

      .filter-actions {
        display: flex;
        gap: 10px;
        align-items: center;
        flex-wrap: wrap;
      }

      .filter-btn-group {
        display: flex;
        gap: 6px;
        flex-wrap: wrap;
      }

      .filter-btn-group .btn {
        border-radius: 10px !important;
        font-size: 0.85rem;
        padding: 8px 16px;
        border: 2px solid #e0e0e0;
        background: white;
        color: #666;
        font-weight: 500;
        transition: all 0.3s ease;
        position: relative;
        overflow: hidden;
      }

      .filter-btn-group .btn::before {
        content: "";
        position: absolute;
        top: 50%;
        left: 50%;
        width: 0;
        height: 0;
        background: rgba(228, 151, 170, 0.1);
        border-radius: 50%;
        transform: translate(-50%, -50%);
        transition: width 0.3s ease, height 0.3s ease;
      }

      .filter-btn-group .btn:active::before {
        width: 100px;
        height: 100px;
      }

      .filter-btn-group .btn:hover {
        border-color: var(--primary-pink);
        color: var(--dark-pink);
        background: rgba(228, 151, 170, 0.05);
        transform: translateY(-2px);
      }

      .filter-btn-group .btn.active {
        background: linear-gradient(
          135deg,
          var(--primary-pink),
          var(--secondary-pink)
        );
        border-color: var(--primary-pink);
        color: white;
        box-shadow: 0 4px 12px rgba(228, 151, 170, 0.3);
      }

      .filter-extra-actions {
        display: flex;
        gap: 10px;
        align-items: center;
      }

      .filter-extra-actions .btn {
        border-radius: 10px;
        font-weight: 600;
        padding: 8px 16px;
        font-size: 0.85rem;
      }

      

      /* Responsive styles for the filter */
      @media (max-width: 768px) {
        .global-filter-container {
          padding: 20px;
        }

        .filter-header {
          flex-direction: column;
          align-items: flex-start;
        }

        .filter-actions {
          width: 100%;
          justify-content: space-between;
        }

        .filter-btn-group {
          width: 100%;
          justify-content: space-between;
          margin-bottom: 15px;
        }

        .filter-btn-group .btn {
          flex: 1;
          text-align: center;
          margin: 2px;
        }

        .filter-extra-actions {
          width: 100%;
          justify-content: space-between;
        }
      }

      @media (max-width: 576px) {
        .filter-btn-group {
          flex-direction: column;
        }

        .filter-btn-group .btn {
          width: 100%;
        }
      }
    </style>
  </head>

  <body>
    <!-- Mobile Header -->
    <div class="mobile-header">
      <div class="mobile-header-content">
        <button class="hamburger-btn" id="hamburgerBtn">
          <i class="fas fa-bars"></i>
        </button>
        <a href="admin.html" class="mobile-logo"
          ><img src="../images/mainlogo1.png" alt="Store Logo"
        /></a>
      </div>
    </div>

    <!-- Sidebar Overlay -->
    <div class="sidebar-overlay" id="sidebarOverlay"></div>

    <div class="container-fluid">
      <div class="row">
        <!-- Sidebar -->
        <nav class="col-md-2 d-md-block sidebar" id="sidebar">
          <div class="logo-container">
            <a href="admin.html"
              ><img src="../images/mainlogo1.png" alt="Store Logo" class="logo"
            /></a>
            <div class="store-name">Blessence</div>
          </div>
          <div class="nav flex-column">
            <a href="admin.html" class="nav-link active">
              <i class="fa-solid fa-tachometer-alt"></i><span>Dashboard</span>
            </a>
            <a href="product-management.html" class="nav-link">
              <i class="fa-solid fa-box"></i><span>Product Management</span>
            </a>
            <a href="recommendation-insights.html" class="nav-link">
              <i class="fa-solid fa-lightbulb"></i
              ><span>Recommendation Insights</span>
            </a>
            <a href="customer-managemnet.html" class="nav-link">
              <i class="fa-solid fa-users"></i><span>Customer Management</span>
            </a>
            <a href="order-transactions.html" class="nav-link">
              <i class="fa-solid fa-credit-card"></i
              ><span>Order Transaction</span>
            </a>
            <a href="activity-log.html" class="nav-link">
              <i class="fa-solid fa-clock-rotate-left"></i
              ><span>Activity Log</span>
            </a>
            <a
              href="javascript:void(0)"
              class="nav-link cashier-mode-link"
              id="cashierModeLink"
            >
              <i class="fa-solid fa-cash-register"></i><span>Cashier Mode</span>
            </a>
            <a id="logoutBtn" href="javascript:void(0)" class="nav-link">
              <i class="fa-solid fa-right-from-bracket"></i><span>Log Out</span>
            </a>
          </div>
        </nav>

        <!-- Main content -->
        <main class="col-md-10">
          <!-- Stats Cards (Draggable Row) -->
          <div class="stats-buttons" id="stats-sortable">
            <div class="stat-wrapper" data-id="stat-orders">
              <button class="stat-btn orders-today w-100">
                <i class="fa-solid fa-cart-shopping"></i>
                <div class="stat-content">
                  <span class="stat-value">--</span>
                  <span class="stat-label">Orders</span>
                </div>
              </button>
            </div>

            <div class="stat-wrapper" data-id="stat-sales-vol">
              <button class="stat-btn this-week w-100">
                <i class="fa-solid fa-calendar-week"></i>
                <div class="stat-content">
                  <span class="stat-value">--</span>
                  <span class="stat-label">Product Sales Volume</span>
                </div>
              </button>
            </div>

            <div class="stat-wrapper" data-id="stat-revenue">
              <button class="stat-btn total-sales w-100">
                <i class="fa-solid fa-coins"></i>
                <div class="stat-content">
                  <span class="stat-value">--</span>
                  <span class="stat-label">Revenue</span>
                </div>
              </button>
            </div>

            <div class="stat-wrapper" data-id="stat-favorites">
              <button class="stat-btn favorites-count w-100">
                <i class="fa-solid fa-heart"></i>
                <div class="stat-content">
                  <span class="stat-value" id="totalFavorites">--</span>
                  <span class="stat-label">Total Favorites</span>
                </div>
              </button>
            </div>
          </div>

          <!-- Export Controls -->
          <div class="export-controls mb-4">
            <div class="card">
              <div class="card-body">
                <div class="row align-items-center">
                  <div class="col-md-6">
                    <h6
                      class="card-title mb-0"
                      style="color: var(--primary-pink)"
                    >
                      <i
                        class="fas fa-download me-2"
                        style="color: var(--primary-pink)"
                      ></i
                      >Export Reports
                  </div>
                  <div class="col-md-6 text-end">
                    <div class="btn-group" role="group">
                      <button
                        type="button"
                        class="btn btn-outline-primary"
                        id="exportCsvBtn"
                      >
                        <i class="fas fa-file-csv me-2"></i>Export CSV
                      </button>
                      <button
                        type="button"
                        class="btn btn-outline-danger"
                        id="exportPdfBtn"
                      >
                        <i class="fas fa-file-pdf me-2"></i>Export PDF
                      </button>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- NEW: Independent Global Filter -->
          <div class="global-filter-container">
            <div class="filter-header">
              <h5><i class="fas fa-filter"></i> Dashboard Filter</h5>
              <div class="filter-actions">
                <div class="filter-btn-group" role="group">
                  <button
                    class="btn btn-outline-secondary btn-sm active"
                    data-period="All Time"
                  >
                    All Time
                  </button>
                  <button
                    class="btn btn-outline-secondary btn-sm"
                    data-period="Daily"
                  >
                    Daily
                  </button>
                  <button
                    class="btn btn-outline-secondary btn-sm"
                    data-period="Weekly"
                  >
                    Weekly
                  </button>
                  <button
                    class="btn btn-outline-secondary btn-sm"
                    data-period="Monthly"
                  >
                    Monthly
                  </button>
                  <button
                    class="btn btn-outline-secondary btn-sm"
                    data-period="Annually"
                  >
                    Annually
                  </button>
                </div>
              </div>
            </div>
          </div>

          <!-- Main Grid Section (Unified & Sortable) -->
          <div class="row" id="dashboard-sortable">
            <!-- 1. Sales Chart (Span 8) -->
            <div
              class="col-lg-8 col-md-12 mb-4 widget-item"
              data-id="widget-sales-chart"
            >
              <div class="draggable-widget sales-chart-widget">
                <i class="fas fa-grip-lines drag-indicator"></i>
                <div class="widget-header">
                  <h5><i class="fas fa-chart-line"></i> Sales Overview</h5>
                </div>

                <!-- FIX: Added this wrapper div -->
                <div class="chart-wrapper-fix">
                  <canvas id="salesChart"></canvas>
                </div>
              </div>
            </div>

            <!-- 2. Recent Activity (NEW - Span 4) -->
            <div
              class="col-lg-4 col-md-12 mb-4 widget-item"
              data-id="widget-recent-activity"
            >
              <div class="draggable-widget">
                <i class="fas fa-grip-lines drag-indicator"></i>
                <div class="widget-header">
                  <h6><i class="fas fa-clock"></i> Recent Activity</h6>
                </div>
                <div class="recent-activity-container scrollable-list">
                  <div class="placeholder-box">
                    <i
                      class="fas fa-clock fa-2x mb-3"
                      style="color: var(--primary-pink)"
                    ></i>
                    <div style="font-size: 1rem; margin-bottom: 6px">
                      Recent Admin Activities
                    </div>
                    <small class="text-muted"
                      >Recent admin actions will appear here</small
                    >
                  </div>
                </div>
              </div>
            </div>

            <!-- 3. Calendar Widget (NEW - Span 4) -->
            <div
              class="col-lg-4 col-md-6 mb-4 widget-item"
              data-id="widget-calendar"
            >
              <div class="draggable-widget">
                <i class="fas fa-grip-lines drag-indicator"></i>
                <div class="widget-header">
                  <h6>
                    <i class="fas fa-calendar-alt"></i> Product Expiration
                    Calendar
                  </h6>
                </div>
                <div class="calendar-container">
                  <div class="calendar-widget">
                    <div class="calendar-header">
                      <div class="calendar-month" id="calendarMonth">
                        March 2025
                      </div>
                      <div class="calendar-nav">
                        <button class="calendar-nav-btn" id="prevMonth">
                          <i class="fas fa-chevron-left"></i>
                        </button>
                        <button class="calendar-nav-btn" id="nextMonth">
                          <i class="fas fa-chevron-right"></i>
                        </button>
                      </div>
                    </div>
                    <div class="calendar-weekdays">
                      <div>Su</div>
                      <div>Mo</div>
                      <div>Tu</div>
                      <div>We</div>
                      <div>Th</div>
                      <div>Fr</div>
                      <div>Sa</div>
                    </div>
                    <div class="calendar-days" id="calendarDays">
                      <!-- Calendar days will be populated by JavaScript -->
                    </div>
                  </div>
                </div>
              </div>
            </div>

            <!-- 4. Best Selling Products (Extracted from Right Panel -> Span 4) -->
            <div
              class="col-lg-4 col-md-12 mb-4 widget-item"
              data-id="widget-best-sellers"
            >
              <div class="draggable-widget">
                <i class="fas fa-grip-lines drag-indicator"></i>
                <div class="widget-header">
                  <h6><i class="fas fa-fire"></i> Best Selling Products</h6>
                </div>
                <div class="best-sellers-container scrollable-list">
                  <div class="placeholder-box">
                    <i
                      class="fas fa-cube fa-2x mb-3"
                      style="color: var(--primary-pink)"
                    ></i>
                    <div style="font-size: 1rem; margin-bottom: 6px">
                      Product Performance Data
                    </div>
                    <small class="text-muted"
                      >Top products will be listed here</small
                    >
                  </div>
                </div>
              </div>
            </div>

            <!-- 5. Sales by Category (Span 4) -->
            <div
              class="col-lg-4 col-md-6 mb-4 widget-item"
              data-id="widget-category"
            >
              <div class="draggable-widget">
                <i class="fas fa-grip-lines drag-indicator"></i>
                <div class="widget-header">
                  <h6><i class="fas fa-chart-pie"></i> Sales by Category</h6>
                </div>
                <div class="small-chart-container">
                  <canvas id="categoryChart"></canvas>
                </div>
              </div>
            </div>

            <!-- 6. Customer Demographics (Span 4) -->
            <div
              class="col-lg-4 col-md-6 mb-4 widget-item"
              data-id="widget-demographics"
            >
              <div class="draggable-widget">
                <i class="fas fa-grip-lines drag-indicator"></i>
                <div class="widget-header">
                  <h6>
                    <i class="fas fa-venus-mars"></i> Customer Demographics
                    (Skin)
                  </h6>
                </div>
                <div class="small-chart-container">
                  <canvas id="demographicsChart"></canvas>
                </div>
              </div>
            </div>

            <!-- 7. Order Status (Extracted from Right Panel -> Span 4) -->
            <div
              class="col-lg-4 col-md-6 mb-4 widget-item"
              data-id="widget-order-status"
            >
              <div class="draggable-widget">
                <i class="fas fa-grip-lines drag-indicator"></i>
                <div class="widget-header">
                  <h6><i class="fas fa-clipboard-list"></i> Order Status</h6>
                </div>
                <div class="small-chart-container" style="height: 200px">
                  <canvas id="orderStatusChart"></canvas>
                </div>
              </div>
            </div>

            <!-- 8. Smart AI Insights (Span 4) -->
            <div
              class="col-lg-4 col-md-6 mb-4 widget-item"
              data-id="widget-ai-insights"
            >
              <div class="draggable-widget">
                <i class="fas fa-grip-lines drag-indicator"></i>
                <div class="widget-header">
                  <h6><i class="fas fa-brain"></i> Smart AI Insights</h6>
                </div>
                <div class="ai-insights-container scrollable-list">
                  <div class="placeholder-box">
                    <i
                      class="fas fa-robot fa-2x mb-3"
                      style="color: var(--primary-pink)"
                    ></i>
                    <div style="font-size: 1rem; margin-bottom: 6px">
                      AI-Powered Recommendations
                    </div>
                    <small class="text-muted"
                      >Insights and suggestions will appear here</small
                    >
                  </div>
                </div>
              </div>
            </div>

            <!-- 9. Top Customers (Span 8 - Table Format) -->
            <div
              class="col-lg-8 col-md-12 mb-4 widget-item"
              data-id="widget-top-customers"
            >
              <div class="draggable-widget">
                <i class="fas fa-grip-lines drag-indicator"></i>
                <div class="widget-header">
                  <h6><i class="fas fa-crown"></i> Top Customers</h6>
                </div>
                <div class="top-customers-container">
                  <div class="placeholder-box">
                    <i
                      class="fas fa-users fa-2x mb-3"
                      style="color: var(--primary-pink)"
                    ></i>
                    <div style="font-size: 1rem; margin-bottom: 6px">
                      Customer Performance Data
                    </div>
                    <small class="text-muted"
                      >Top customers will be listed here</small
                    >
                  </div>
                </div>
              </div>
            </div>

            <!-- 10. Store Ratings (Extracted from Right Panel -> Span 4) -->
            <div
              class="col-lg-4 col-md-6 mb-4 widget-item"
              data-id="widget-store-ratings"
            >
              <div class="draggable-widget">
                <i class="fas fa-grip-lines drag-indicator"></i>
                <div class="widget-header">
                  <div class="d-flex align-items-center gap-2">
                    <h6 style="margin: 0">
                      <i class="fas fa-star"></i> Store Ratings
                    </h6>
                  </div>
                  <span class="view-all-link" id="viewAllReviewsBtn"
                    >View All</span
                  >
                </div>
                <div class="ratings-container scrollable-list">
                  <div class="placeholder-box">
                    <i
                      class="fas fa-star fa-2x mb-3"
                      style="color: var(--primary-pink)"
                    ></i>
                    <div style="font-size: 1rem; margin-bottom: 6px">
                      Customer Feedback & Ratings
                    </div>
                    <small class="text-muted"
                      >Rating statistics will appear here</small
                    >
                  </div>
                </div>
              </div>
            </div>
          </div>
        </main>
      </div>
    </div>

    <!-- Reviews Modal -->
    <div class="modal fade" id="reviewsModal" tabindex="-1" aria-hidden="true">
      <div
        class="modal-dialog modal-dialog-centered modal-dialog-scrollable modal-lg"
      >
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title">
              <i class="fas fa-comments me-2"></i>All Store Reviews
            </h5>
            <!-- Close button added for better UX -->
            <button
              type="button"
              class="btn-close"
              data-bs-dismiss="modal"
              aria-label="Close"
            ></button>

            <div class="filter-controls">
              <!-- Rating Filter Dropdown -->
              <div class="dropdown">
                <button
                  class="btn custom-dropdown-btn dropdown-toggle"
                  type="button"
                  id="ratingDropdownBtn"
                  data-bs-toggle="dropdown"
                  aria-expanded="false"
                  data-bs-boundary="viewport"
                >
                  All Ratings
                </button>
                <ul
                  class="dropdown-menu custom-dropdown-menu"
                  aria-labelledby="ratingDropdownBtn"
                >
                  <li>
                    <a
                      class="dropdown-item custom-dropdown-item active"
                      data-value="all"
                      onclick="selectFilter('rating', 'all', 'All Ratings', this)"
                      >All Ratings</a
                    >
                  </li>
                  <li>
                    <a
                      class="dropdown-item custom-dropdown-item"
                      data-value="5"
                      onclick="selectFilter('rating', '5', 'â˜…â˜…â˜…â˜…â˜… (5 Stars)', this)"
                      >â˜…â˜…â˜…â˜…â˜… (5 Stars)</a
                    >
                  </li>
                  <li>
                    <a
                      class="dropdown-item custom-dropdown-item"
                      data-value="4"
                      onclick="selectFilter('rating', '4', 'â˜…â˜…â˜…â˜…â˜† (4 Stars)', this)"
                      >â˜…â˜…â˜…â˜…â˜† (4 Stars)</a
                    >
                  </li>
                  <li>
                    <a
                      class="dropdown-item custom-dropdown-item"
                      data-value="3"
                      onclick="selectFilter('rating', '3', 'â˜…â˜…â˜…â˜†â˜† (3 Stars)', this)"
                      >â˜…â˜…â˜…â˜†â˜† (3 Stars)</a
                    >
                  </li>
                  <li>
                    <a
                      class="dropdown-item custom-dropdown-item"
                      data-value="2"
                      onclick="selectFilter('rating', '2', 'â˜…â˜…â˜†â˜†â˜† (2 Stars)', this)"
                      >â˜…â˜…â˜†â˜†â˜† (2 Stars)</a
                    >
                  </li>
                  <li>
                    <a
                      class="dropdown-item custom-dropdown-item"
                      data-value="1"
                      onclick="selectFilter('rating', '1', 'â˜…â˜†â˜†â˜†â˜† (1 Star)', this)"
                      >â˜…â˜†â˜†â˜†â˜† (1 Star)</a
                    >
                  </li>
                </ul>
                <input type="hidden" id="reviewFilter" value="all" />
              </div>

              <!-- Sort Filter Dropdown -->
              <div class="dropdown">
                <button
                  class="btn custom-dropdown-btn dropdown-toggle"
                  type="button"
                  id="sortDropdownBtn"
                  data-bs-toggle="dropdown"
                  aria-expanded="false"
                  data-bs-boundary="viewport"
                >
                  Newest First
                </button>
                <ul
                  class="dropdown-menu custom-dropdown-menu"
                  aria-labelledby="sortDropdownBtn"
                >
                  <li>
                    <a
                      class="dropdown-item custom-dropdown-item active"
                      data-value="newest"
                      onclick="selectFilter('sort', 'newest', 'Newest First', this)"
                      >Newest First</a
                    >
                  </li>
                  <li>
                    <a
                      class="dropdown-item custom-dropdown-item"
                      data-value="oldest"
                      onclick="selectFilter('sort', 'oldest', 'Oldest First', this)"
                      >Oldest First</a
                    >
                  </li>
                </ul>
                <input type="hidden" id="reviewSort" value="newest" />
              </div>
            </div>
          </div>

          <div class="modal-body" id="modalReviewsBody">
            <div class="text-center py-5">
              <div class="spinner-border text-pink" role="status"></div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Add this modal for product expiration details -->
    <div
      class="modal fade"
      id="expirationModal"
      tabindex="-1"
      aria-hidden="true"
    >
      <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title">
              <i class="fas fa-calendar-exclamation me-2"></i>Expiring Products
            </h5>
            <button
              type="button"
              class="btn-close"
              data-bs-dismiss="modal"
              aria-label="Close"
            ></button>
          </div>
          <div class="modal-body" id="expirationModalBody">
            <!-- Content will be populated by JavaScript -->
          </div>
        </div>
      </div>
    </div>

    <!-- Reveal Overlay & Cashier Mode Elements -->
    <div class="reveal-overlay" id="revealOverlay"></div>
    <div class="fullscreen-reveal" id="fullscreenReveal">
      <div class="reveal-progress" id="revealProgress"></div>
      <div class="fullscreen-reveal-content">Entering Cashier Modeâ€¦</div>
    </div>

    <div class="cashier-mode-entry" id="cashierModeEntry">
      <div class="cashier-logo-container">
        <div class="cashier-logo">
          <img src="../images/mainlogo1.png" alt="Store Logo" />
        </div>
        <div class="cashier-title">Entering Cashier Mode</div>
        <div class="cashier-subtitle">Blessence Point of Sale</div>
      </div>
      <div class="cashier-loading">
        <div class="cashier-loading-dot"></div>
        <div class="cashier-loading-dot"></div>
        <div class="cashier-loading-dot"></div>
      </div>
    </div>
    <div class="cashier-tap-counter" id="cashierTapCounter"></div>

    <!-- Bootstrap 5 JS Bundle -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

    <script>
      document.addEventListener("DOMContentLoaded", async () => {
        // ----------------------------------------------------
        // 1. ADMIN SESSION & AUTHENTICATION
        // ----------------------------------------------------

        // Check if external auth scripts loaded correctly
        if (typeof setupAdminPageProtection === "function") {
          setupAdminPageProtection();
        }

        let currentAdmin = null;
        if (typeof fetchAdminSession === "function") {
          currentAdmin = await fetchAdminSession();
        }

        // Stop execution if not logged in
        if (!currentAdmin) return;

        if (typeof updateAdminGreeting === "function") {
          await updateAdminGreeting();
        }

        // ----------------------------------------------------
        // 2. GLOBAL VARIABLES & INSTANCES
        // ----------------------------------------------------
        let salesChartInstance = null;
        let categoryChartInstance = null;
        let demographicsChartInstance = null;
        let orderStatusChartInstance = null;

        // Calendar Data
        let currentDate = new Date();
        let expiringProducts = {};

        // ----------------------------------------------------
        // 3. EXPORT FUNCTIONALITY (CSV & PDF)
        // ----------------------------------------------------
        const exportCsvBtn = document.getElementById("exportCsvBtn");
        const exportPdfBtn = document.getElementById("exportPdfBtn");

        if (exportCsvBtn) exportCsvBtn.addEventListener("click", exportToCSV);
        if (exportPdfBtn) exportPdfBtn.addEventListener("click", exportToPDF);

        async function exportToCSV() {
          try {
            const activeBtn = document.querySelector(".filter-btn-group .btn.active");
            const period = activeBtn ? activeBtn.dataset.period : "All Time";

            const originalText = exportCsvBtn.innerHTML;
            exportCsvBtn.innerHTML =
              '<i class="fas fa-spinner fa-spin me-2"></i>Exporting...';
            exportCsvBtn.disabled = true;

            // Trigger download
            window.open(
              `../php/admin.php?action=export_csv&period=${encodeURIComponent(
                period
              )}`,
              "_blank"
            );

            setTimeout(() => {
              exportCsvBtn.innerHTML = originalText;
              exportCsvBtn.disabled = false;
            }, 2000);
          } catch (error) {
            console.error("Export error:", error);
            Swal.fire({
              icon: "error",
              title: "Export Failed",
              text: "Could not export CSV.",
            });
          }
        }

        async function exportToPDF() {
          try {
            const activeBtn = document.querySelector(".filter-btn-group .btn.active");
            const period = activeBtn ? activeBtn.dataset.period : "All Time";

            const originalText = exportPdfBtn.innerHTML;
            exportPdfBtn.innerHTML =
              '<i class="fas fa-spinner fa-spin me-2"></i>Generating PDF...';
            exportPdfBtn.disabled = true;

            const response = await fetch(
              `../php/admin.php?action=export_data&period=${encodeURIComponent(
                period
              )}`
            );
            const result = await response.json();

            if (result.success) {
              generatePDF(result.data, period);
            } else {
              Swal.fire("Error", "Failed to generate PDF data", "error");
            }

            exportPdfBtn.innerHTML = originalText;
            exportPdfBtn.disabled = false;
          } catch (error) {
            console.error("PDF export error:", error);
            Swal.fire({
              icon: "error",
              title: "PDF Export Failed",
              text: "Could not generate PDF.",
            });
            if (exportPdfBtn) {
              exportPdfBtn.innerHTML = originalText;
              exportPdfBtn.disabled = false;
            }
          }
        }

        function generatePDF(data, period) {
          const printWindow = window.open("", "_blank");

          // Enhanced PDF template with monthly/annual revenue and better ratings
          const pdfContent = `
    <!DOCTYPE html>
    <html>
    <head>
        <title>Blessence Report - ${period}</title>
        <style>
            body { font-family: Arial, sans-serif; margin: 20px; color: #333; line-height: 1.4; }
            .header { text-align: center; border-bottom: 3px solid #e497aa; padding-bottom: 20px; margin-bottom: 30px; }
            .header h1 { color: #e497aa; margin: 0; font-size: 28px; }
            .header p { margin: 5px 0; color: #666; }
            .section { margin-bottom: 30px; page-break-inside: avoid; }
            .section h2 { color: #e497aa; border-bottom: 2px solid #f0f0f0; padding-bottom: 10px; margin-bottom: 15px; font-size: 18px; }
            .metrics-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 15px; margin-bottom: 20px; }
            .metric-card { background: #fff5f9; padding: 15px; border-radius: 8px; border-left: 4px solid #e497aa; }
            .metric-value { font-size: 24px; font-weight: bold; color: #e497aa; margin-bottom: 5px; }
            .metric-label { font-size: 14px; color: #666; }
            table { width: 100%; border-collapse: collapse; margin: 15px 0; font-size: 14px; }
            th { background: #e497aa; color: white; padding: 12px; text-align: left; font-weight: 600; }
            td { padding: 10px 12px; border-bottom: 1px solid #eee; }
            .rating-bar { background: #f0f0f0; border-radius: 10px; height: 20px; margin: 5px 0; overflow: hidden; }
            .rating-fill { background: #ffd700; height: 100%; border-radius: 10px; }
            .insight { background: #f8f9fa; padding: 12px; margin: 8px 0; border-radius: 8px; border-left: 4px solid #e497aa; }
            .review-item { border: 1px solid #eee; padding: 12px; margin: 8px 0; border-radius: 8px; }
            .stars { color: #ffd700; font-weight: bold; }
            .footer { text-align: center; margin-top: 40px; color: #666; font-size: 12px; padding-top: 20px; border-top: 1px solid #eee; }
            .revenue-highlight { background: #fff5f9; padding: 15px; border-radius: 8px; margin: 10px 0; border: 1px solid #e497aa; }
        </style>
    </head>
    <body>
        <div class="header">
            <h1>Blessence Dashboard Report</h1>
            <p><strong>Period:</strong> ${period} | <strong>Generated:</strong> ${
            data.export_info.export_date
          }</p>
            <p><strong>Generated By:</strong> ${
              data.export_info.generated_by
            }</p>
        </div>
        
        <div class="section">
            <h2>ðŸ“Š Key Performance Indicators</h2>
            <div class="metrics-grid">
                <div class="metric-card">
                    <div class="metric-value">${data.stats.orders_today}</div>
                    <div class="metric-label">Orders Today</div>
                </div>
                <div class="metric-card">
                    <div class="metric-value">â‚±${parseFloat(
                      data.stats.total_sales
                    ).toLocaleString("en-US", {
                      minimumFractionDigits: 2,
                    })}</div>
                    <div class="metric-label">Total Revenue</div>
                </div>
            </div>
        </div>

        <div class="section">
            <h2>ðŸ“ˆ Sales Overview</h2>
            <table>
                <thead><tr><th>Date</th><th>Sales (â‚±)</th><th>Orders</th></tr></thead>
                <tbody>
                    ${data.chart_data
                      .map(
                        (item) =>
                          `<tr><td>${item.display_date}</td><td>â‚±${parseFloat(
                            item.sales || 0
                          ).toLocaleString()}</td><td>${
                            item.orders || 0
                          }</td></tr>`
                      )
                      .join("")}
                </tbody>
            </table>
        </div>

        <div class="section">
            <h2>ðŸ’° Monthly Revenue</h2>
            ${
              data.monthly_revenue && data.monthly_revenue.length > 0
                ? `<table>
                    <thead><tr><th>Month</th><th>Revenue</th></tr></thead>
                    <tbody>
                        ${data.monthly_revenue
                          .map(
                            (month) =>
                              `<tr>
                                <td>${month.month}</td>
                                <td><strong>â‚±${parseFloat(
                                  month.revenue
                                ).toLocaleString("en-US", {
                                  minimumFractionDigits: 2,
                                })}</strong></td>
                            </tr>`
                          )
                          .join("")}
                    </tbody>
                </table>`
                : '<p class="revenue-highlight">No monthly revenue data available for the selected period.</p>'
            }
        </div>

        <div class="section">
            <h2>ðŸ“… Annual Revenue</h2>
            ${
              data.annual_revenue && data.annual_revenue.length > 0
                ? `<table>
                    <thead><tr><th>Year</th><th>Revenue</th></tr></thead>
                    <tbody>
                        ${data.annual_revenue
                          .map(
                            (year) =>
                              `<tr>
                                <td>${year.year}</td>
                                <td><strong>â‚±${parseFloat(
                                  year.revenue
                                ).toLocaleString("en-US", {
                                  minimumFractionDigits: 2,
                                })}</strong></td>
                            </tr>`
                          )
                          .join("")}
                    </tbody>
                </table>`
                : '<p class="revenue-highlight">No annual revenue data available for the selected period.</p>'
            }
        </div>

        <div class="section">
            <h2>â­ Store Ratings & Reviews</h2>
            <div class="metrics-grid">
                <div class="metric-card">
                    <div class="metric-value">${parseFloat(
                      data.ratings.average_rating || 0
                    ).toFixed(1)}/5</div>
                    <div class="metric-label">Average Rating</div>
                </div>
                <div class="metric-card">
                    <div class="metric-value">${
                      data.ratings.total_reviews || 0
                    }</div>
                    <div class="metric-label">Total Reviews</div>
                </div>
            </div>

            <h3 style="margin-top: 20px; color: #666;">Rating Distribution</h3>
            ${[5, 4, 3, 2, 1]
              .map((stars) => {
                const count = data.ratings[stars + "_star"] || 0;
                const percent = data.ratings[stars + "_star_percent"] || 0;
                return `
                <div style="display: flex; align-items: center; margin: 8px 0;">
                    <div style="width: 80px;">${"â˜…".repeat(stars)}</div>
                    <div style="flex: 1; margin: 0 10px;">
                        <div class="rating-bar">
                            <div class="rating-fill" style="width: ${percent}%"></div>
                        </div>
                    </div>
                    <div style="width: 100px; text-align: right;">${count} (${percent}%)</div>
                </div>`;
              })
              .join("")}

            <h3 style="margin-top: 25px; color: #666;">Recent Customer Feedback</h3>
            ${
              data.ratings.recent_reviews &&
              data.ratings.recent_reviews.length > 0
                ? data.ratings.recent_reviews
                    .slice(0, 5)
                    .map(
                      (review) => `
                    <div class="review-item">
                        <div style="display: flex; justify-content: space-between; margin-bottom: 8px;">
                            <strong>${review.username || "Anonymous"}</strong>
                            <span class="stars">${"â˜…".repeat(
                              review.rating
                            )}</span>
                        </div>
                        <p style="margin: 0; color: #666;">${
                          review.comment || "No comment provided"
                        }</p>
                        <small style="color: #999;">${new Date(
                          review.created_at
                        ).toLocaleDateString()}</small>
                    </div>
                `
                    )
                    .join("")
                : "<p>No recent reviews available.</p>"
            }
        </div>

        <div class="section">
            <h2>ðŸ¤– AI Insights</h2>
            ${data.ai_insights
              .map((insight) => `<div class="insight">${insight}</div>`)
              .join("")}
        </div>

        <div class="footer">
            <p>Confidential - For internal use only</p>
            <p>Generated by Blessence Admin Dashboard</p>
        </div>

        <script>
            window.onload = function() { 
                setTimeout(() => { 
                    window.print(); 
                    setTimeout(() => { window.close(); }, 500);
                }, 1000); 
            };
        <\/script>
    </body>
    </html>`;

          printWindow.document.write(pdfContent);
          printWindow.document.close();
        }

        // ----------------------------------------------------
        // 4. DRAG AND DROP (SortableJS)
        // ----------------------------------------------------
        const loadLayout = (storageKey, containerId) => {
          const savedOrder = localStorage.getItem(storageKey);
          const container = document.getElementById(containerId);
          if (savedOrder && container) {
            const order = JSON.parse(savedOrder);
            order.forEach((id) => {
              const el = container.querySelector(`[data-id="${id}"]`);
              if (el) container.appendChild(el);
            });
          }
        };

        const saveLayout = (storageKey, sortable) => {
          const order = sortable.toArray();
          localStorage.setItem(storageKey, JSON.stringify(order));
        };

        // Initialize Stats Row
        const statsContainer = document.getElementById("stats-sortable");
        if (statsContainer) {
          loadLayout("admin_dashboard_stats_order", "stats-sortable");
          new Sortable(statsContainer, {
            animation: 150,
            ghostClass: "sortable-ghost",
            dragClass: "sortable-drag",
            dataIdAttr: "data-id",
            onEnd: function () {
              saveLayout("admin_dashboard_stats_order", this);
            },
          });
        }

        // Initialize Main Grid
        const gridContainer = document.getElementById("dashboard-sortable");
        if (gridContainer) {
          loadLayout("admin_dashboard_grid_order", "dashboard-sortable");
          new Sortable(gridContainer, {
            animation: 150,
            ghostClass: "sortable-ghost",
            dragClass: "sortable-drag",
            handle: ".widget-header",
            dataIdAttr: "data-id",
            onEnd: function () {
              saveLayout("admin_dashboard_grid_order", this);
              // Resize charts after drag to fix layout shifts
              Object.values(Chart.instances).forEach((chart) => chart.resize());
            },
          });
        }

        // ----------------------------------------------------
        // 5. MOBILE & UI LOGIC
        // ----------------------------------------------------
        const hamburgerBtn = document.getElementById("hamburgerBtn");
        const sidebar = document.getElementById("sidebar");
        const sidebarOverlay = document.getElementById("sidebarOverlay");
        const mainContent = document.querySelector("main");
        const mobileHeader = document.querySelector(".mobile-header");

        const toggleSidebar = () => {
          if (sidebar) sidebar.classList.toggle("mobile-open");
          if (sidebarOverlay) sidebarOverlay.classList.toggle("active");
        };

        if (hamburgerBtn) hamburgerBtn.addEventListener("click", toggleSidebar);
        if (sidebarOverlay)
          sidebarOverlay.addEventListener("click", toggleSidebar);

        // Cashier Mode Animation Trigger
        const cashierLink = document.getElementById("cashierModeLink");
        if (cashierLink) {
          cashierLink.addEventListener("click", (e) => {
            e.preventDefault();
            const reveal = document.getElementById("fullscreenReveal");
            const overlay = document.getElementById("revealOverlay");
            const entry = document.getElementById("cashierModeEntry");

            if (reveal && overlay && entry) {
              overlay.style.display = "block";
              setTimeout(() => {
                overlay.style.opacity = "1";
              }, 10);

              reveal.classList.add("active");
              setTimeout(() => {
                reveal.classList.add("expanding");
              }, 100);

              setTimeout(() => {
                entry.classList.add("active");
                // Redirect after animation
                setTimeout(() => {
                  window.location.href = "../pos/pos.html"; // Assuming this path
                }, 2000);
              }, 900);
            } else {
              window.location.href = "../pos/pos.html";
            }
          });
        }

        // ----------------------------------------------------
        // 6. CALENDAR LOGIC
        // ----------------------------------------------------
        const renderCalendar = (year, month) => {
          const calendarMonth = document.getElementById("calendarMonth");
          const calendarDays = document.getElementById("calendarDays");
          if (!calendarMonth || !calendarDays) return;

          const monthNames = [
            "January",
            "February",
            "March",
            "April",
            "May",
            "June",
            "July",
            "August",
            "September",
            "October",
            "November",
            "December",
          ];
          calendarMonth.textContent = `${monthNames[month]} ${year}`;

          const firstDay = new Date(year, month, 1).getDay();
          const daysInMonth = new Date(year, month + 1, 0).getDate();
          const daysInPrevMonth = new Date(year, month, 0).getDate();

          calendarDays.innerHTML = "";

          // Previous Month
          for (let i = firstDay - 1; i >= 0; i--) {
            const day = document.createElement("div");
            day.className = "calendar-day other-month";
            day.textContent = daysInPrevMonth - i;
            calendarDays.appendChild(day);
          }

          // Current Month
          const today = new Date();
          for (let i = 1; i <= daysInMonth; i++) {
            const day = document.createElement("div");
            day.className = "calendar-day";
            day.textContent = i;

            // Highlight Today
            if (
              year === today.getFullYear() &&
              month === today.getMonth() &&
              i === today.getDate()
            ) {
              day.classList.add("today");
            }

            // Check Expiration
            const dateStr = `${year}-${String(month + 1).padStart(
              2,
              "0"
            )}-${String(i).padStart(2, "0")}`;
            if (
              expiringProducts[dateStr] &&
              expiringProducts[dateStr].length > 0
            ) {
              day.classList.add("expiring");

              const expirationDate = new Date(dateStr);
              const daysUntilExpiration = Math.ceil(
                (expirationDate - today) / (1000 * 60 * 60 * 24)
              );

              if (daysUntilExpiration <= 7) day.classList.add("critical");
              else if (daysUntilExpiration <= 30) day.classList.add("warning");
              else day.classList.add("normal");

              // Tooltip
              const tooltip = document.createElement("div");
              tooltip.className = "calendar-tooltip";
              const count = expiringProducts[dateStr].length;
              tooltip.textContent = `${count} product${
                count > 1 ? "s" : ""
              } expiring`;
              day.appendChild(tooltip);

              // Click Event
              day.addEventListener("click", () =>
                showExpirationDetails(dateStr, expiringProducts[dateStr])
              );
            }

            calendarDays.appendChild(day);
          }
        };

        const showExpirationDetails = (date, products) => {
          const modalEl = document.getElementById("expirationModal");
          const modalBody = document.getElementById("expirationModalBody");

          if (!modalEl || !modalBody) return;

          const modal = new bootstrap.Modal(modalEl);
          let html = `<h6 class="mb-3 text-pink fw-bold">Expiring on ${date}</h6>`;

          products.forEach((p) => {
            const isLow = p.Stocks <= 5;
            html += `
          <div class="d-flex justify-content-between align-items-center p-2 mb-2 border rounded ${
            isLow ? "bg-danger-subtle" : "bg-light"
          }">
            <div>
              <div class="fw-bold">${p.Name}</div>
              <small class="text-muted">${p.Category}</small>
            </div>
            <div class="text-end">
              <span class="badge ${
                isLow ? "bg-danger" : "bg-warning text-dark"
              }">${p.Stocks} units left</span>
            </div>
          </div>
        `;
          });

          modalBody.innerHTML = html;
          modal.show();
        };

        document.getElementById("prevMonth")?.addEventListener("click", () => {
          currentDate.setMonth(currentDate.getMonth() - 1);
          renderCalendar(currentDate.getFullYear(), currentDate.getMonth());
        });

        document.getElementById("nextMonth")?.addEventListener("click", () => {
          currentDate.setMonth(currentDate.getMonth() + 1);
          renderCalendar(currentDate.getFullYear(), currentDate.getMonth());
        });

        // ----------------------------------------------------
        // 7. RECENT ACTIVITY & UPDATERS
        // ----------------------------------------------------
        const updateRecentActivity = (activities) => {
          const container = document.querySelector(
            ".recent-activity-container"
          );
          if (!container) return;

          if (!activities || !activities.length) {
            container.innerHTML = `<div class="placeholder-box"><i class="fas fa-clock fa-2x mb-3" style="color:var(--primary-pink)"></i><div>No recent activity</div></div>`;
            return;
          }

          container.innerHTML = activities
            .map((activity) => {
              const iconMap = {
                reviewed: "fa-comment-check",
                updated: "fa-edit",
                created: "fa-plus-circle",
                cancelled: "fa-times-circle",
                processed: "fa-cash-register",
              };
              const icon = iconMap[activity.type] || "fa-circle";
              const time = new Date(activity.timestamp).toLocaleTimeString([], {
                hour: "2-digit",
                minute: "2-digit",
              });

              return `
          <div class="activity-item">
            <div class="activity-icon" style="background: #fff0f5; color: var(--primary-pink);"><i class="fas ${icon}"></i></div>
            <div class="activity-content">
              <div class="activity-title">${activity.title}</div>
              <div class="activity-details">${activity.details}</div>
              <div class="activity-time">${time}</div>
            </div>
          </div>`;
            })
            .join("");
        };

        const updateStats = (stats) => {
          const setVal = (sel, val) => {
            const el = document.querySelector(sel);
            if (el) el.textContent = val;
          };
          setVal(".orders-today .stat-value", stats.orders_today || 0);
          setVal(".this-week .stat-value", stats.orders_week || 0);
          setVal(
            ".total-sales .stat-value",
            "â‚±" +
              parseFloat(stats.total_sales || 0).toLocaleString(undefined, {
                minimumFractionDigits: 2,
              })
          );
          setVal(".favorites-count .stat-value", stats.total_favorites || 0);
        };

        const updateBestSellers = (products) => {
          const container = document.querySelector(".best-sellers-container");
          if (!container) return;
          if (!products || !products.length) {
            container.innerHTML = `<div class="placeholder-box"><i class="fas fa-cube fa-2x mb-3" style="color:var(--primary-pink)"></i><div>No sales data</div></div>`;
            return;
          }
          container.innerHTML = products
            .map(
              (p) => `
        <div class="product-item d-flex align-items-center justify-content-between p-3 mb-2">
          <div><div class="fw-bold" style="color:var(--dark-pink)">${p.product_name}</div><small class="text-muted">${p.Category} â€¢ ${p.total_quantity} sold</small></div>
        </div>`
            )
            .join("");
        };

        const updateStoreRatings = (ratings) => {
          const container = document.querySelector(".ratings-container");
          if (!ratings) {
            container.innerHTML = `<div class="placeholder-box"><i class="fas fa-star fa-2x mb-3" style="color:var(--primary-pink)"></i><div>No ratings available</div></div>`;
            return;
          }
          const avg = parseFloat(ratings.average_rating || 0).toFixed(1);
          const total = ratings.total_reviews || 0;
          if (total === 0) {
            container.innerHTML = `<div class="placeholder-box"><i class="fas fa-star fa-2x mb-3" style="color:var(--primary-pink)"></i><div>No ratings yet</div></div>`;
            return;
          }

          let starsHTML = "";
          for (let i = 0; i < Math.floor(avg); i++)
            starsHTML += '<i class="fas fa-star text-warning"></i>';
          if (avg % 1 >= 0.5)
            starsHTML += '<i class="fas fa-star-half-alt text-warning"></i>';

          let barsHTML = [5, 4, 3, 2, 1]
            .map((s) => {
              const c = ratings[`${s}_star`] || 0;
              const pct = total > 0 ? (c / total) * 100 : 0;
              return `<div class="d-flex align-items-center mb-2"><span style="width:20px">${s}</span><i class="fas fa-star text-warning me-2" style="font-size:0.8rem"></i><div class="progress flex-grow-1 me-2" style="height:8px"><div class="progress-bar" style="width:${pct}%; background-color:var(--primary-pink)"></div></div><small class="text-muted" style="width:30px">${c}</small></div>`;
            })
            .join("");

          let recentReviewsHTML = "";
          if (ratings.recent_reviews && ratings.recent_reviews.length > 0) {
            recentReviewsHTML =
              '<div class="mt-4"><h6 class="mb-3" style="font-size:0.95rem; color:var(--dark-pink); font-weight:600;">Recent Reviews</h6>';
            ratings.recent_reviews.forEach((review) => {
              const reviewDate = new Date(review.created_at).toLocaleDateString(
                "en-US",
                { month: "short", day: "numeric", year: "numeric" }
              );
              const reviewStars =
                "â˜…".repeat(review.rating) + "â˜†".repeat(5 - review.rating);
              const userName = review.username || "Anonymous";

              recentReviewsHTML += `
          <div class="customer-item p-3 mb-2" style="background:white; border-radius:10px;">
            <div class="d-flex align-items-start mb-2">
              <div class="flex-grow-1">
                <div class="d-flex justify-content-between align-items-center mb-1">
                  <span class="fw-bold" style="color:var(--dark-pink); font-size:0.9rem">${userName}</span>
                  <small class="text-muted" style="font-size:0.75rem">${reviewDate}</small>
                </div>
                <div class="mb-2" style="color:#FFC107; font-size:0.85rem">${reviewStars}</div>
                ${
                  review.comment
                    ? `<p class="mb-0" style="font-size:0.85rem; color:#666; line-height:1.4">${review.comment}</p>`
                    : ""
                }
              </div>
            </div>
          </div>
        `;
            });
            recentReviewsHTML += "</div>";
          }

          container.innerHTML = `<div class="text-center mb-3"><div style="font-size:2.5rem; font-weight:bold; color:var(--dark-pink)">${avg}</div><div class="mb-2">${starsHTML}</div><small class="text-muted">${total} reviews</small></div><div>${barsHTML}</div>${recentReviewsHTML}`;
        };

        const updateAIInsights = (insights) => {
          const container = document.querySelector(".ai-insights-container");
          if (!container) return;
          if (!insights || !insights.length) {
            container.innerHTML = `<div class="placeholder-box"><i class="fas fa-robot fa-2x mb-3" style="color:var(--primary-pink)"></i><div>No insights yet</div></div>`;
            return;
          }
          container.innerHTML = insights
            .map(
              (i) =>
                `<div class="insight-item p-3 mb-2"><div class="d-flex align-items-start"><i class="fas fa-lightbulb me-2" style="color: var(--primary-pink);"></i><small>${i}</small></div></div>`
            )
            .join("");
        };

        const updateTopCustomers = (customers) => {
          const container = document.querySelector(".top-customers-container");
          if (!customers || !customers.length) {
            container.innerHTML = `<div class="placeholder-box"><i class="fas fa-users fa-2x mb-3" style="color:var(--primary-pink)"></i><div>No data</div></div>`;
            return;
          }

          let tableHTML = `
    <div class="customers-table-wrapper">
      <table class="customers-table">
        <thead>
          <tr>
            <th>Rank</th>
            <th>Customer</th>
            <th>Total Orders</th>
            <th>Total Spent</th>
          </tr>
        </thead>
        <tbody>
  `;

          customers.forEach((c, index) => {
            const name =
              c.first_name && c.last_name
                ? `${c.first_name} ${c.last_name}`
                : c.username || "Unknown";

            const email = c.email || "";

            // Determine rank class for top 3
            let rankClass = "";
            if (index === 0) rankClass = "gold";
            else if (index === 1) rankClass = "silver";
            else if (index === 2) rankClass = "bronze";

            // Avatar or initial
            let avatarHTML = "";
            if (
              c.profile_photo &&
              c.profile_photo.trim() !== "" &&
              c.profile_photo !== "default.png"
            ) {
              avatarHTML = `<img src="../../uploads/profiles/${c.profile_photo}" alt="${name}" class="customer-table-avatar" onerror="this.style.display='none'; this.nextElementSibling.style.display='flex';">`;
              avatarHTML += `<div class="customer-table-initial" style="display:none;">${name
                .charAt(0)
                .toUpperCase()}</div>`;
            } else {
              avatarHTML = `<div class="customer-table-initial">${name
                .charAt(0)
                .toUpperCase()}</div>`;
            }

            tableHTML += `
      <tr>
        <td>
          <span class="customer-rank ${rankClass}">${index + 1}</span>
        </td>
        <td>
          <div class="customer-info">
            ${avatarHTML}
            <div>
              <div class="customer-name">${name}</div>
              ${email ? `<div class="customer-email">${email}</div>` : ""}
            </div>
          </div>
        </td>
        <td>
          <div class="customer-orders">
            <span class="badge">${c.total_orders} orders</span>
          </div>
        </td>
        <td>
          <div class="customer-spent">â‚±${parseFloat(c.total_spent || 0).toFixed(
            2
          )}</div>
        </td>
      </tr>
    `;
          });

          tableHTML += `
        </tbody>
      </table>
    </div>
  `;
          container.innerHTML = tableHTML;
        };

        // ----------------------------------------------------
        // 8. CHART RENDERING
        // ----------------------------------------------------
        const renderCategoryChart = (data) => {
          const ctx = document.getElementById("categoryChart");
          if (!ctx) return;
          if (categoryChartInstance) categoryChartInstance.destroy();

          const labels =
            data && data.length ? data.map((d) => d.Category) : ["No Data"];
          const values =
            data && data.length ? data.map((d) => d.total_items_sold) : [1];
          const colors = [
            "#e497aa",
            "#db8299",
            "#c36c82",
            "#b05a70",
            "#9d4e5f",
          ];

          categoryChartInstance = new Chart(ctx.getContext("2d"), {
            type: "doughnut",
            data: {
              labels: labels,
              datasets: [
                {
                  data: values,
                  backgroundColor: data && data.length ? colors : ["#f0f0f0"],
                  borderWidth: 2,
                  borderColor: "#ffffff",
                },
              ],
            },
            options: {
              responsive: true,
              maintainAspectRatio: false,
              plugins: {
                legend: {
                  position: window.innerWidth < 768 ? "bottom" : "right",
                },
              },
            },
          });
        };

        const renderDemographicsChart = (data) => {
          const ctx = document.getElementById("demographicsChart");
          if (!ctx) return;
          if (demographicsChartInstance) demographicsChartInstance.destroy();

          const labels =
            data && data.length ? data.map((d) => d.skin_type) : ["No Data"];
          const values = data && data.length ? data.map((d) => d.count) : [1];

          demographicsChartInstance = new Chart(ctx.getContext("2d"), {
            type: "polarArea",
            data: {
              labels: labels,
              datasets: [
                {
                  data: values,
                  backgroundColor: [
                    "rgba(228, 151, 170, 0.8)",
                    "rgba(219, 130, 153, 0.8)",
                    "rgba(195, 108, 130, 0.8)",
                    "rgba(176, 90, 112, 0.8)",
                  ],
                },
              ],
            },
            options: {
              responsive: true,
              maintainAspectRatio: false,
              scales: { r: { ticks: { backdropColor: "transparent" } } },
              plugins: { legend: { position: "bottom" } },
            },
          });
        };

        const renderOrderStatusChart = (data) => {
          const ctx = document.getElementById("orderStatusChart");
          if (!ctx) return;
          if (orderStatusChartInstance) orderStatusChartInstance.destroy();

          let labels = [],
            values = [],
            bgColors = [];
          if (data && data.length) {
            labels = data.map((d) => d.status.toUpperCase());
            values = data.map((d) => d.count);
            const statusColors = {
              COMPLETED: "#28a745",
              PENDING: "#ffc107",
              CANCELLED: "#dc3545",
              PROCESSING: "#17a2b8",
            };
            bgColors = labels.map((l) => statusColors[l] || "#6c757d");
          } else {
            labels = ["No Data"];
            values = [1];
            bgColors = ["#f0f0f0"];
          }

          // Check for DataLabels plugin availability
          const plugins =
            typeof ChartDataLabels !== "undefined" ? [ChartDataLabels] : [];

          orderStatusChartInstance = new Chart(ctx.getContext("2d"), {
            type: "bar",
            data: {
              labels: labels,
              datasets: [
                {
                  label: "Orders",
                  data: values,
                  backgroundColor: bgColors,
                  borderRadius: 5,
                },
              ],
            },
            options: {
              indexAxis: "y",
              responsive: true,
              maintainAspectRatio: false,
              plugins: {
                legend: { display: false },
                datalabels: {
                  color: "white",
                  font: { weight: "bold" },
                  formatter: (value) => (value > 0 ? value : ""),
                },
              },
              scales: {
                x: { display: false },
                y: { grid: { display: false } },
              },
            },
            plugins: plugins,
          });
        };

        const renderSalesChart = (chartData) => {
          const ctx = document.getElementById("salesChart");
          if (!ctx) return;
          if (salesChartInstance) salesChartInstance.destroy();

          const context = ctx.getContext("2d");
          let labels = [],
            salesData = [],
            ordersData = [];

          if (chartData && chartData.length) {
            labels = chartData.map((i) => i.display_date || i.date);
            salesData = chartData.map((i) => parseFloat(i.sales) || 0);
            ordersData = chartData.map((i) => parseInt(i.orders) || 0);
          } else {
            labels = ["No Data"];
            salesData = [0];
            ordersData = [0];
          }

          const gradient = context.createLinearGradient(0, 0, 0, 400);
          gradient.addColorStop(0, "rgba(228, 151, 170, 0.3)");
          gradient.addColorStop(1, "rgba(228, 151, 170, 0.05)");

          salesChartInstance = new Chart(context, {
            type: "line",
            data: {
              labels: labels,
              datasets: [
                {
                  label: "Sales (â‚±)",
                  data: salesData,
                  borderColor: "#e497aa",
                  backgroundColor: gradient,
                  fill: true,
                  tension: 0.4,
                  yAxisID: "y",
                },
                {
                  label: "Orders",
                  data: ordersData,
                  borderColor: "#db8299",
                  borderDash: [5, 5],
                  fill: false,
                  tension: 0.4,
                  yAxisID: "y1",
                },
              ],
            },
            options: {
              responsive: true,
              maintainAspectRatio: false,
              interaction: { mode: "index", intersect: false },
              scales: {
                y: {
                  position: "left",
                  beginAtZero: true,
                  ticks: { callback: (v) => "â‚±" + v.toLocaleString() },
                },
                y1: {
                  position: "right",
                  beginAtZero: true,
                  grid: { drawOnChartArea: false },
                },
                x: { grid: { display: false } },
              },
            },
          });
        };

        // ----------------------------------------------------
        // 9. REVIEWS MODAL (FIXED SCOPE)
        // ----------------------------------------------------
        const viewAllBtn = document.getElementById("viewAllReviewsBtn");
        const reviewsModalEl = document.getElementById("reviewsModal");
        let reviewsModal = reviewsModalEl
          ? new bootstrap.Modal(reviewsModalEl)
          : null;
        const reviewFilter = document.getElementById("reviewFilter");
        const reviewSort = document.getElementById("reviewSort");
        const modalBody = document.getElementById("modalReviewsBody");

        const fetchReviews = async () => {
          if (!modalBody) return;
          const filter = reviewFilter ? reviewFilter.value : "all";
          const sort = reviewSort ? reviewSort.value : "newest";

          modalBody.innerHTML =
            '<div class="text-center py-4"><div class="spinner-border text-pink" role="status"></div></div>';

          try {
            const response = await fetch(
              `../php/admin.php?action=get_reviews&rating=${filter}&sort=${sort}`
            );
            const result = await response.json();

            if (result.success && result.reviews.length) {
              let html = "";
              result.reviews.forEach((r) => {
                const stars =
                  '<i class="fas fa-star text-warning"></i>'.repeat(r.rating) +
                  '<i class="far fa-star text-warning"></i>'.repeat(
                    5 - r.rating
                  );
                html += `<div class="p-3 mb-2 border-bottom">
                        <div class="d-flex justify-content-between"><strong>${
                          r.username
                        }</strong><small>${new Date(
                  r.created_at
                ).toLocaleDateString()}</small></div>
                        <div class="mb-1">${stars}</div>
                        <p class="mb-0 text-muted small">${
                          r.comment || "No comment"
                        }</p>
                    </div>`;
              });
              modalBody.innerHTML = html;
            } else {
              modalBody.innerHTML =
                '<div class="text-center py-5 text-muted">No reviews found.</div>';
            }
          } catch (e) {
            console.error(e);
            modalBody.innerHTML =
              '<div class="text-center text-danger">Error loading reviews.</div>';
          }
        };

        // Make selectFilter accessible globally so onclick attributes work
        window.selectFilter = function (type, value, text, element) {
          const inputId = type === "rating" ? "reviewFilter" : "reviewSort";
          const btnId =
            type === "rating" ? "ratingDropdownBtn" : "sortDropdownBtn";

          const input = document.getElementById(inputId);
          const btn = document.getElementById(btnId);

          if (input) input.value = value;
          if (btn) btn.textContent = text;

          if (element) {
            const menu = element.closest(".dropdown-menu");
            if (menu) {
              menu
                .querySelectorAll(".custom-dropdown-item")
                .forEach((i) => i.classList.remove("active"));
              element.classList.add("active");
            }
          }
          fetchReviews();
        };

        if (viewAllBtn && reviewsModal) {
          viewAllBtn.addEventListener("click", () => {
            reviewsModal.show();
            fetchReviews();
          });
        }

        // ----------------------------------------------------
        // 10. DASHBOARD MANAGER (DATA FETCHING)
        // ----------------------------------------------------
        class DashboardManager {
          constructor() {
            this.currentPeriod = "All Time";
            this.isLoading = false;
            this.init();
          }
          init() {
            this.bindEvents();
            this.fetchAndRefreshDashboard(this.currentPeriod);
          }
          bindEvents() {
            // Update to use the new filter buttons
            document.querySelectorAll(".filter-btn-group .btn").forEach((btn) => {
              btn.addEventListener("click", (e) => {
                const period = e.target.dataset.period;
                if (
                  period &&
                  period !== this.currentPeriod &&
                  !this.isLoading
                ) {
                  this.currentPeriod = period;
                  document
                    .querySelectorAll(".filter-btn-group .btn")
                    .forEach((b) =>
                      b.classList.toggle("active", b.dataset.period === period)
                    );
                  this.fetchAndRefreshDashboard(period);
                }
              });
            });

            // Apply and Reset buttons
            const applyFilterBtn = document.getElementById("applyFilterBtn");
            const resetFilterBtn = document.getElementById("resetFilterBtn");

            if (applyFilterBtn) {
              applyFilterBtn.addEventListener("click", () => {
                const activeBtn = document.querySelector(".filter-btn-group .btn.active");
                const period = activeBtn ? activeBtn.dataset.period : "All Time";
                this.fetchAndRefreshDashboard(period);
              });
            }

            if (resetFilterBtn) {
              resetFilterBtn.addEventListener("click", () => {
                this.currentPeriod = "All Time";
                document
                  .querySelectorAll(".filter-btn-group .btn")
                  .forEach((b) =>
                    b.classList.toggle("active", b.dataset.period === "All Time")
                  );
                this.fetchAndRefreshDashboard("All Time");
              });
            }

            // Handle resize to fix chart scaling
            let resizeTimeout;
            window.addEventListener("resize", () => {
              clearTimeout(resizeTimeout);
              resizeTimeout = setTimeout(() => {
                this.handleResize();
              }, 250);
            });
          }

          handleResize() {
            if (
              salesChartInstance ||
              categoryChartInstance ||
              demographicsChartInstance
            ) {
              this.fetchAndRefreshDashboard(this.currentPeriod, true);
            }
          }

          async fetchAndRefreshDashboard(period, isResize = false) {
            if (this.isLoading && !isResize) return;
            this.isLoading = true;

            try {
              const response = await fetch(
                `../php/admin.php?period=${encodeURIComponent(period)}`
              );
              const result = await response.json();
              if (result.success) {
                this.refreshAllComponents(result.data);
              }
            } catch (error) {
              console.error("Error fetching dashboard data:", error);
            } finally {
              this.isLoading = false;
            }
          }

          refreshAllComponents(data) {
            renderSalesChart(data.chart_data);
            renderCategoryChart(data.category_sales);
            renderDemographicsChart(data.customer_demographics);
            renderOrderStatusChart(data.order_status_dist);
            updateStats(data.stats);
            updateBestSellers(data.best_sellers);
            updateStoreRatings(data.ratings);
            updateAIInsights(data.ai_insights);
            updateTopCustomers(data.top_customers);
            updateRecentActivity(data.recent_activity || []);

            expiringProducts = data.expiring_dates || {};
            renderCalendar(currentDate.getFullYear(), currentDate.getMonth());
          }
        }

        // Initialize Dashboard
        const dashboardManager = new DashboardManager();
        window.dashboardManager = dashboardManager;

        // ----------------------------------------------------
        // 11. FIXED AUTO-REFRESH INTERVAL
        // ----------------------------------------------------
        setInterval(() => {
          const activeBtn = document.querySelector(".filter-btn-group .btn.active");
          const period = activeBtn ? activeBtn.dataset.period : "All Time";
          console.log(`Auto-refreshing dashboard for: ${period}`);
          dashboardManager.fetchAndRefreshDashboard(period);
        }, 300000); // Refresh every 5 minutes
      });
    </script>
  </body>
</html>